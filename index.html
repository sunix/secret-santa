<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#c41e3a">
    <meta name="description" content="Application Secret Santa - Organisez votre √©change de cadeaux">
    <title>Secret Santa</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="icon-192.png">
</head>
<body>
    <!-- Preview Banner -->
    <div id="preview-banner" style="display: none; position: fixed; top: 0; left: 0; right: 0; z-index: 9999; background: linear-gradient(135deg, #c41e3a 0%, #165b33 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 20px; gap: 12px;">
        <div style="font-size: 24px; flex-shrink: 0;">üéÖ</div>
        <div style="flex: 1; color: white;">
          <strong style="display: block; font-size: 14px;">Environnement de Pr√©visualisation</strong>
          <span style="display: block; font-size: 12px; opacity: 0.9;">Ceci n'est pas le site officiel - Environnement de test uniquement</span>
        </div>
        <a id="preview-banner-pr-link" href="#" style="display: none; background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s ease; flex-shrink: 0; align-items: center; gap: 6px; text-decoration: none;" target="_blank" rel="noopener noreferrer">
          üí¨ Donnez votre avis sur la PR
        </a>
        <button id="preview-banner-close" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 50%; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s ease; flex-shrink: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;" aria-label="Close">‚úï</button>
      </div>
    </div>
    
    <!-- Fullscreen Reveal Overlay -->
    <div id="reveal-overlay" class="reveal-overlay" style="display: none;">
        <div class="reveal-content">
            <div class="countdown-timer" id="countdown-timer"></div>
            <div class="reveal-text" id="reveal-text"></div>
            <canvas id="confetti-canvas" class="confetti-canvas"></canvas>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-top">
                <h1>üéÖ Secret Santa</h1>
                <div class="language-selector-wrapper">
                    <label for="language-selector">üåê</label>
                    <select id="language-selector" class="language-selector">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            <p class="subtitle">Organisez votre √©change de cadeaux</p>
        </header>

        <main>
            <!-- Section: Participant Management -->
            <section id="setup-section" class="card">
                <h2>Participants</h2>
                <div class="input-group">
                    <input type="text" id="participant-name" placeholder="Nom du participant" />
                    <button id="add-participant" class="btn btn-primary">Ajouter</button>
                </div>
                
                <div id="participants-list" class="participants-list"></div>

                <!-- Couples Management -->
                <div class="couples-section">
                    <h3>Couples</h3>
                    <p class="help-text">Les couples ne pourront pas se tirer entre eux</p>
                    <div class="input-group">
                        <select id="couple-person1" class="couple-select">
                            <option value="">Choose...</option>
                        </select>
                        <select id="couple-person2" class="couple-select">
                            <option value="">Choose...</option>
                        </select>
                        <button id="add-couple" class="btn btn-secondary">Ajouter couple</button>
                    </div>
                    <div id="couples-list" class="couples-list"></div>
                </div>

                <button id="start-draw" class="btn btn-primary btn-large" disabled>Commencer le tirage</button>
            </section>

            <!-- Section: Drawing Process -->
            <section id="draw-section" class="card" style="display: none;">
                <h2>Tirage en cours</h2>
                <div id="draw-info" class="draw-info"></div>
                <div class="draw-actions">
                    <button id="next-draw" class="btn btn-primary btn-large">Tirer le suivant</button>
                    <button id="restart-draw" class="btn btn-secondary">Recommencer</button>
                </div>
            </section>

            <!-- Section: Results -->
            <section id="results-section" class="card" style="display: none;">
                <h2>‚ú® Tirage termin√© !</h2>
                <div id="results-list" class="results-list"></div>
                <div class="draw-actions">
                    <button id="new-draw" class="btn btn-primary">Nouveau tirage</button>
                </div>
            </section>
        </main>

        <footer>
            <p>üéÑ Joyeuses f√™tes ! üéÅ</p>
        </footer>
    </div>

    <script src="app.js"></script>
    
    <!-- Preview Banner Script -->
    <script>
    (function() {
      // Show banner only on surge.sh or preview environments
      if (window.location.hostname.includes('surge.sh') || window.location.hostname.includes('preview')) {
        var banner = document.getElementById('preview-banner');
        var closeBtn = document.getElementById('preview-banner-close');
        var prLink = document.getElementById('preview-banner-pr-link');
        
        if (banner) {
          banner.style.display = 'block';
          document.body.style.paddingTop = '60px';
        }
        
        // Extract PR number from hostname (format: pr-[NUMBER]-secret-santa-preview.surge.sh)
        var hostname = window.location.hostname;
        var prMatch = hostname.match(/^pr-(\d+)-/);
        if (prMatch && prMatch[1] && prLink) {
          var prNumber = prMatch[1];
          // Validate PR number contains only digits (additional safety check)
          if (/^\d+$/.test(prNumber)) {
            prLink.href = 'https://github.com/sunix/secret-santa/pull/' + encodeURIComponent(prNumber);
            prLink.style.display = 'inline-flex';
          }
        }
        
        if (closeBtn) {
          closeBtn.addEventListener('click', function() {
            if (banner) {
              banner.style.display = 'none';
              document.body.style.paddingTop = '0';
            }
          });
          
          // Add hover effect to close button
          closeBtn.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(255,255,255,0.35)';
          });
          closeBtn.addEventListener('mouseleave', function() {
            this.style.background = 'rgba(255,255,255,0.2)';
          });
        }
        
        if (prLink) {
          prLink.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(255,255,255,0.35)';
          });
          prLink.addEventListener('mouseleave', function() {
            this.style.background = 'rgba(255,255,255,0.2)';
          });
        }
      }
    })();
    </script>
</body>
</html>
